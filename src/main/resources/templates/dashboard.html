<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªëng k√™ doanh thu - Song L√¢m Edu</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>
<body>
<div th:replace="~{fragments/header}"></div>
<div class="app-shell">
    <div th:replace="~{fragments/sidebar}"></div>
    <main class="app-content">
        <h1 class="page-title-box">üìä Th·ªëng k√™ thu chi</h1>

        <div id="info-container" class="info-wrap">
            <!-- Tab Navigation -->
            <div class="dashboard-tabs">
                <button type="button" class="dashboard-tab active" data-tab="month" onclick="switchDashboardTab('month')">
                    üìÖ Theo th√°ng
                </button>
                <button type="button" class="dashboard-tab" data-tab="quarter" onclick="switchDashboardTab('quarter')">
                    üìÜ Theo qu√Ω
                </button>
                <button type="button" class="dashboard-tab" data-tab="year" onclick="switchDashboardTab('year')">
                    üìà Theo nƒÉm
                </button>
            </div>

            <!-- Filter Section -->
            <div class="dashboard-filters">
                <div id="monthFilter" class="filter-group">
                    <div class="filter-item">
                        <label>NƒÉm:</label>
                        <select id="monthYearSelect" onchange="loadStats()">
                            <th:block th:each="y : ${years}">
                                <option th:value="${y}" th:text="${y}" th:selected="${y == currentYear}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Th√°ng:</label>
                        <select id="monthSelect" onchange="loadStats()">
                            <option value="1">Th√°ng 1</option>
                            <option value="2">Th√°ng 2</option>
                            <option value="3">Th√°ng 3</option>
                            <option value="4">Th√°ng 4</option>
                            <option value="5">Th√°ng 5</option>
                            <option value="6">Th√°ng 6</option>
                            <option value="7">Th√°ng 7</option>
                            <option value="8">Th√°ng 8</option>
                            <option value="9">Th√°ng 9</option>
                            <option value="10">Th√°ng 10</option>
                            <option value="11">Th√°ng 11</option>
                            <option value="12">Th√°ng 12</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="button" id="exportFundBtnMonth" class="btn btn-export" onclick="exportFund()">
                            üì• S·ªï Qu·ªπ Ti·ªÅn M·∫∑t
                        </button>
                        <button type="button" id="exportExcelBtnMonth" class="btn btn-export" onclick="exportReport()">
                            üì• Xu·∫•t Excel
                        </button>
                    </div>
                </div>

                <div id="quarterFilter" class="filter-group hidden">
                    <div class="filter-item">
                        <label>NƒÉm:</label>
                        <select id="quarterYearSelect" onchange="loadStats()">
                            <th:block th:each="y : ${years}">
                                <option th:value="${y}" th:text="${y}" th:selected="${y == currentYear}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Qu√Ω:</label>
                        <select id="quarterSelect" onchange="loadStats()">
                            <option value="1">Qu√Ω 1 (T1-T3)</option>
                            <option value="2">Qu√Ω 2 (T4-T6)</option>
                            <option value="3">Qu√Ω 3 (T7-T9)</option>
                            <option value="4">Qu√Ω 4 (T10-T12)</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="button" id="exportFundBtnQuarter" class="btn btn-export" onclick="exportFund()">
                            üì• S·ªï Qu·ªπ Ti·ªÅn M·∫∑t
                        </button>
                        <button type="button" id="exportExcelBtnQuarter" class="btn btn-export" onclick="exportReport()">
                            üì• Xu·∫•t Excel
                        </button>
                    </div>
                </div>

                <div id="yearFilter" class="filter-group hidden">
                    <div class="filter-item">
                        <label>NƒÉm:</label>
                        <select id="yearSelect" onchange="loadStats()">
                            <th:block th:each="y : ${years}">
                                <option th:value="${y}" th:text="${y}" th:selected="${y == currentYear}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="button" id="exportFundBtnYear" class="btn btn-export" onclick="exportFund()">
                            üì• S·ªï Qu·ªπ Ti·ªÅn M·∫∑t
                        </button>
                        <button type="button" id="exportExcelBtnYear" class="btn btn-export" onclick="exportReport()">
                            üì• Xu·∫•t Excel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="stats-cards">
                <div class="stats-card revenue">
                    <div class="stats-icon">üí∞</div>
                    <div class="stats-content">
                        <div class="stats-label">T·ªïng thu</div>
                        <div class="stats-value" id="totalRevenue">0 VNƒê</div>
                        <div class="stats-sub" id="revenueCount">0 giao d·ªãch</div>
                    </div>
                </div>
                <div class="stats-card expense">
                    <div class="stats-icon">üí∏</div>
                    <div class="stats-content">
                        <div class="stats-label">T·ªïng chi</div>
                        <div class="stats-value" id="totalExpense">0 VNƒê</div>
                        <div class="stats-sub" id="expenseCount">0 giao d·ªãch</div>
                    </div>
                </div>
                <div class="stats-card balance">
                    <div class="stats-icon">üìä</div>
                    <div class="stats-content">
                        <div class="stats-label">S·ªë d∆∞</div>
                        <div class="stats-value" id="balance">0 VNƒê</div>
                    </div>
                </div>
            </div>

            <!-- Timeline Chart -->
            <div class="daily-chart-section">
                <h3 class="chart-title" id="timelineChartTitle">üìà Bi·ªÉu ƒë·ªì thu - chi theo tu·∫ßn</h3>
                <div class="chart-legend">
                    <span class="legend-item revenue-legend">üü¢ Thu</span>
                    <span class="legend-item expense-legend">üî¥ Chi</span>
                </div>
                <div class="daily-chart-container" id="timelineChart">
                    <div class="loading-placeholder">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <h3 class="chart-title">üìö Thu theo m√¥n h·ªçc</h3>
                    <div class="chart-content" id="subjectChart">
                        <div class="loading-placeholder">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">üè´ Thu theo l·ªõp h·ªçc</h3>
                    <div class="chart-content" id="classChart">
                        <div class="loading-placeholder">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<input type="hidden" id="initMonth" th:value="${currentMonth}">
<input type="hidden" id="initQuarter" th:value="${currentQuarter}">
<input type="hidden" id="initYear" th:value="${currentYear}">

<script th:src="@{/js/app.js}"></script>
<script th:src="@{/js/common.js}"></script>
<script th:src="@{/js/dashboard.js}"></script>
</body>
</html>